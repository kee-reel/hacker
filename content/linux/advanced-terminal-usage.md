---
title: Linux. Продвинутое использование терминала
date: 2021-09-15
tag: linux
draft: true
---

Прежде чем ты начнёшь постигать Linux кунг-фу при использовании конкретных программ, стоит отточить базовые навыки использования терминала, чтобы поднять скорость взаимодействия с терминалом на новый уровень.

Я напишу про слежующие техники:

* Редактирование команд
* Перемещение по истории команд

# Редактирование команд

При работе с терминалом часто приходится редактировать уже написанные команды.

Чтобы изменить какое-то слово в команде, все новички зажимают стрелку вправо/влево, и ждут пока курсор до туда доползёт, чтобы потом зажать `Delete` или `Backspace` для удаления слова:

{{< gif "common editing" "/assets/gifs/linux-common-editing.gif" >}}

Так вот, забудь про зажимание стрелок на клавиатуре -- каждый раз, когда ты это делаешь, у тебя отнимается 10 очков стиля.

Вместо стрелок, `Delete` и `Backspace`, используй следующие горячие клавиши:

* `Alt+F` -- сдвинуться на слово вперёд (F - forward)
* `Alt+B` -- сдвинуться на слово назад (B - backward)
* `Ctrl+A` -- переместиться в начало строки (я запомнил как "**A**АААА...)
* `Ctrl+E` -- переместиться в конец строки ("...**Е**ЕЕЕЕ РОККК!")
* `Ctrl+W` -- удалить предыдущее слово

Вот тебе, для сравнения, то же самое редактирование команды, что и выше, но с помощью `Alt+B`, `Alt+B`, `Ctrl+W`, `Ctrl+W`:

{{< gif "pro editing" "/assets/gifs/linux-pro-editing.gif" >}}

Попробуй сам поиграться со всеми указанными горячими клавишами с этой же командой:

```
echo 'this is example of some command'
```

Эти горячие клавиши впитаются в подкорку только при условии постоянной практики, так что просто старайся с этого дня использовать их как можно чаще.

# Перемещение по истории команд

Иногда тебе надо ещё раз исполнить команду, которую ты исполнял до этого -- для этого в терминале существует история команд.

Для работы с историей команд тебе надо знать 3 основных комбинации:

* `Ctrl+P` -- предыдущая команда
* `Ctrl+N` -- следующая команда
* `Ctrl+R` -- поиск в истории команд (поиск идёт в направлении от новых команд к старым)

Вот тебе пример, как можно перемещаться взад/вперёд по истории с помощью `Ctrl+P`/`Ctrl+N`:

{{< gif "history navigation" "/assets/gifs/linux-history-navigation.gif" >}}

> Обрати внимание что я перемещаюсь по словам через `Alt+B` и удаляю их через `Ctrl+W`

Вот пример поиска в истории команд -- нажимаешь `Ctrl+R`, пишешь слово и оно появляется в строке. Ты можешь нажать `Enter` чтобы исполнить команду, а стрелочку чтобы начать редактировать выбранную команду:

{{< gif "history search" "/assets/gifs/linux-history-search.gif" >}}

Ещё можно искать определённое слово во всех подходящих командах -- нажимаешь `Ctrl+R`, пишешь слово, нажимаешь `Ctrl+R` чтобы перейти на следующую подходящую команду (`Enter` чтобы исполнить команду):

{{< gif "history search repeat" "/assets/gifs/linux-history-search-repeat.gif" >}}

> Вся история команд хранится в файле `~/.bash_history` -- терминал берёт её оттуда.

Попробуй воспользоваться этими горячими клавишами прямо сейчас:

* Пройдись туда-сюда с помощью `Ctrl+P` и `Ctrl+N`
* Поищи какую-нибудь команду с помощью `Ctrl+R`
* Понажимай `Ctrl+R` несколько раз, чтобы найти несколько подходящих команд

# Что такое Bash

Сейчас будет небольшое откровение -- терминал в Linux это тоже программа, которая называется **bash**.

> Bash расшифровывается как "**B**ourn **A**gain **Sh**ell", типо "Перерожденный Shell". "Shell" (англ. "Оболочка") -- это одновременно и синоним слова "терминал", и отслылка к более древнему терминалу "sh".

> Кроме Bash есть еще терминалы zsh, fish, sh.

Как ты мог уже понять, терминал передает твои команды операционной системе, однако он не передает их напрямую -- он интерпретирует твою команду, и делает соответствующий **системный вызов**.

> Что такое системный вызов ты можешь прочитать [тут]()

Однако Bash это не просто программа, которая исполняет твои команды -- это интерпретатор языка программирования Bash, который предоставляет следующие, вполне базовые для любого языка, возможности:
* Переменные
* Условия
* Циклы
* Массивы
* Функции

> Если ты не знаком с этими базовыми понятиями, то рекомендую сначала освоить какой-либо язык программирования (например [Python](/python/)

Кроме этого, он еще предоставляет в некоторой степени уникальные возможности:
* Сокращения (alias)
* Конвейеры (pipe)
* Перенаправление вывода

Если ты освоишь хотя бы базовые возможности Bash, то ты сможешь писать программы, способные автоматизировать любую задачу, которую ты мог бы решить вручную!

Полноценный разбор Bash я вынесу в отдельную статью, а пока я опишу что-то настолько простое, что ты сможешь это применить прямо сейчас.

## Конфигурация .bashrc

Каждый раз, когда ты запускаешь Bash, он сначала исполняет содержимое программы на языке Bash, которая находится в `~/.bashrc`.

> Скорее всего в твоём файле `~/.bashrc` уже что-то есть -- почти во всех дистрибутивах Linux `.bashrc` содержит набор полезных переменных/функций/команд

## Переменные

**Переменная окружения** -- это переменная с определённым значением, используемая в рамках текущей сессии.

Переменная задаётся так:

```
ИМЯ_ПЕРЕМЕННОЙ=ЗНАЧЕНИЕ_ПЕРЕМЕННОЙ
```

Например, в своём `.bashrc` ты можешь задать переменную `HISTSIZE`, которая определяет максимальное количество команд, которое терминал будет помнить:

```
HISTSIZE=10000
```

Если ты добавишь в свой `.bashrc` эту строчку, то она считается при открытии новой сессии, и терминал будет "помнить" 10000 последних команд.

Существует множество различных параметров, которые ты можешь настроить -- я укажу несколько полезных.

### PATH

Переменная **PATH** содержит пути (разделённые ":"), которые используются для поиска исполняемых программ.

Например, вот так в **PATH** можно добавить директорию `~/bin`:
```
PATH="~/bin:$PATH"
```

> Перед `$PATH` написан **$**, чтобы вставить значение самой переменной `PATH` -- таким образом мы склеиваем "~/bin:" и текущее значение PATH.
> Ещё с помощью **$** ты можешь вывести текущее значение переменной:
> ```
> echo $PATH
> ```

Так вот, мы добавили директорию "~/bin" в PATH. Предположим, что в этой директории лежит программа "hack-the-planet":

```
kee-reel@blog:~/bin$ ls
hack-the-planet
```

Обычно, если нужно исполнить программу из текущей директории, тебе надо написать "./":

```
kee-reel@blog:~/bin$ ./hack-the-planet
HACKING FOLDER ~/bin
COMPLETE!
```

Но, если директория с этой программой находится в PATH, то ты можешь исполнить эту программу откуда угодно (писать "./" не надо):

```
kee-reel@blog:~/some/other/folder$ hack-the-planet
HACKING FOLDER ~/some/other/folder
COMPLETE!
```

> Про PATH рассказал больше, чем про остальные, потому что это самая главная переменная окружения

### HISTCONTROL

Не сохранять в истории дублирующиеся команды (если одна и та же команда исполняется несколько раз)

```
HISTCONTROL='ignoredups'
# Более компактный вид приглашения командной строки
PS1='\[\033[01;32m\]\W\[\033[01;32m\] \$\[\033[00m\] '
```

Если что -- пиши, я помогу и постараюсь объяснить лучше.
