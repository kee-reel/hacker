<!DOCTYPE html>
<html lang="ru">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
	<meta name="description" content="IT простым языком">
	<meta name="generator" content="HUGO">

	<meta name="theme-color" content="#ffffff">

    
    
    <link rel="stylesheet" href="http://kee-reel.com/sass/main.c3c167415800f2394c3296fcddb264b8afea9703b424d3003f18be3b0f9e64bc.css" integrity="sha256-w8FnQVgA8jlMMpb83bJkuK/qlwO0JNMAPxi&#43;Ow&#43;eZLw=">
</head>

<body>
	<div id="top"/>
<header>
    <p align="center">
        +---------------------------+<br>
        |.-------------------------.|<br>
        ||&nbsp;<a href="/">kee_reel@blog</a>:~$ cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/c">c</a>&nbsp;&nbsp;<a href="/cpp">c++</a>&nbsp;&nbsp;<a href="/python">python</a>&nbsp;&nbsp;<a href="/linux">linux</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/opengl">opengl</a>&nbsp;&nbsp;<a href="/sql">sql</a>&nbsp;&nbsp;<a href="/network">networks</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about">обо_мне</a>&nbsp;||<br>
        |.-------------------------.|<br>
        +-::---------------------::-+<br>
        .---------------------------.<br>
        &nbsp;//&nbsp;/o<a href="/links">o</a>oooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        &nbsp;//&nbsp;/oooooooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        //-------------------------------\\<br>
        \\-------------------------------//<br>
    </p>
</header>

		
	<div id="wrapper">
		<div class="container">
			<section id="main_content">
    <h1>C&#43;&#43;. Полиморфизм, виртуальные и абстрактные методы</h1>
    
    
        <h3>Время чтения: 5 мин</h3>
    
    <p>Давай добавим <code>public</code> метод <code>talk()</code> в классы <code>Cat</code> и <code>Horse</code>, и уберём вывод строки из конструктора:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Cat</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Cat(<span style="color:#66d9ef">float</span> fluffiness, <span style="color:#66d9ef">int</span> weight, <span style="color:#66d9ef">int</span> age) <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        Animal(weight, age, <span style="color:#ae81ff">15</span>),
</span></span><span style="display:flex;"><span>        m_fluffiness(fluffiness)
</span></span><span style="display:flex;"><span>    {}
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> talk()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Mew mew&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Horse</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Horse(<span style="color:#66d9ef">float</span> speed, <span style="color:#66d9ef">int</span> weight, <span style="color:#66d9ef">int</span> age) <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        Animal(weight, age, <span style="color:#ae81ff">30</span>),
</span></span><span style="display:flex;"><span>        m_speed(speed)
</span></span><span style="display:flex;"><span>    {}
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> talk()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Pfrrr&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>Теперь можно узнать как делает кошечка и лошадка:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Cat a1(<span style="color:#ae81ff">0.8</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">15</span>);
</span></span><span style="display:flex;"><span>    Horse a2(<span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">268</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">25</span>);
</span></span><span style="display:flex;"><span>    a1.talk();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Mew mew
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    a2.talk();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Pfrrr
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>А что если мы захотим открыть питомник для животных? Для этого нам придётся хранить объекты вроде <code>Cat</code> и <code>Animal</code> в массиве:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> count;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> count;
</span></span><span style="display:flex;"><span>    Cat <span style="color:#f92672">**</span>cat_array <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Cat<span style="color:#f92672">*</span>[count];
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> count;
</span></span><span style="display:flex;"><span>    Horse <span style="color:#f92672">**</span>horse_array <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Horse<span style="color:#f92672">*</span>[count];
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><p>Ой, это под каждый новый класс, наследованный от <code>Animal</code> создавать по массиву? А можно всех в один засунуть?</p>
<p>Можно:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Вспомогательные функции для ввода значений
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_float</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;: &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> field;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> field;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> field;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Когда пройдём шаблоны, это можно будет записать без дублирования кода
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> <span style="color:#a6e22e">get_int</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;: &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> field;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> field;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> field;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> get_int(<span style="color:#e6db74">&#34;count&#34;</span>);
</span></span><span style="display:flex;"><span>    Animal <span style="color:#f92672">**</span>animals <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Animal<span style="color:#f92672">*</span>[count];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> animal_type <span style="color:#f92672">=</span> get_int(<span style="color:#e6db74">&#34;animal type (0 - cat, 1 - horse)&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(animal_type <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> animal_type <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Wrong animal type, try again&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>            i<span style="color:#f92672">--</span>; <span style="color:#75715e">// Вычитаем 1, чтобы следующая итерация прибавила 1 и мы остались на том же i
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Animal <span style="color:#f92672">*</span>a;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> weight <span style="color:#f92672">=</span> get_int(<span style="color:#e6db74">&#34;weight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> age <span style="color:#f92672">=</span> get_int(<span style="color:#e6db74">&#34;age&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span>(animal_type)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">float</span> fluffiness <span style="color:#f92672">=</span> get_float(<span style="color:#e6db74">&#34;fluffiness&#34;</span>);
</span></span><span style="display:flex;"><span>                a <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Cat(fluffiness, weight, age);
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">float</span> speed <span style="color:#f92672">=</span> get_float(<span style="color:#e6db74">&#34;speed&#34;</span>);
</span></span><span style="display:flex;"><span>                a <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Horse(speed, weight, age);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        animals[i] <span style="color:#f92672">=</span> a;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// После этого все животные &#34;скажут&#34; что-то
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        animals[i]<span style="color:#f92672">-&gt;</span>talk();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>При компиляции вылезет такая ошибка:</p>
<pre tabindex="0"><code>animal.cpp: In function ‘int main()’:
animal.cpp:121:21: error: ‘class Animal’ has no member named ‘talk’
  121 |         animals[i]-&gt;talk();
      |                     ^~~~
</code></pre><p>Он ругается, что <code>Animal</code> не знает такого метода. Ну да, у нас же в массиве лежат <code>Animal*</code>, а там такого метода нет.</p>
<p>Хмм, ну давай попробуем добавить ему этот метод:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Animal</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> talk()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Abstract animal&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>Теперь всё скомпилируется:</p>
<pre tabindex="0"><code>count: 2
animal type (0 - cat, 1 - horse): 1
weight: 150
age: 14
speed: 17
animal type (0 - cat, 1 - horse): 0
weight: 4
age: 1
fluffiness: 0.9
Abstract animal
Abstract animal
</code></pre><p>Так, почему выводит &ldquo;Abstract animal&rdquo;? <code>Cat</code> и <code>Horse</code> не перезаписали метод <code>talk()</code>?</p>
<p>Давай попробуем добавить явное приведение к типу <code>Cat*</code> и вызовем методы <code>talk()</code> и <code>shed_weight()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Animal #&#34;</span> <span style="color:#f92672">&lt;&lt;</span> i <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>        ((Cat<span style="color:#f92672">*</span>)animals[i])<span style="color:#f92672">-&gt;</span>talk();
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Cat will shed &#34;</span> <span style="color:#f92672">&lt;&lt;</span> ((Cat<span style="color:#f92672">*</span>)animals[i])<span style="color:#f92672">-&gt;</span>shed_weight() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; kg of hair in a day&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Получится такой вывод:</p>
<pre tabindex="0"><code>count: 2
animal type (0 - cat, 1 - horse): 0
weight: 1
age: 0
fluffiness: 1
animal type (0 - cat, 1 - horse): 1
weight: 140
age: 15
speed: 30
Animal #0
Mew mew
Cat will shed 0.1 kg of hair in a day
Animal #1
Mew mew
Cat will shed 1.5 kg of hair in a day
</code></pre><p>Воу, теперь они все мяукают, даже лошадь! А если привести к типу <code>Horse*</code> и вызывать <code>travel_time</code>?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Animal #&#34;</span> <span style="color:#f92672">&lt;&lt;</span> i <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>        ((Horse<span style="color:#f92672">*</span>)animals[i])<span style="color:#f92672">-&gt;</span>talk();
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Horse will cover 1km in &#34;</span> <span style="color:#f92672">&lt;&lt;</span> ((Horse<span style="color:#f92672">*</span>)animals[i])<span style="color:#f92672">-&gt;</span>travel_time(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; hours&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>А теперь все стали лошадьми:</p>
<pre tabindex="0"><code>count: 2
animal type (0 - cat, 1 - horse): 0
weight: 1
age: 0
fluffiness: 1
animal type (0 - cat, 1 - horse): 1
weight: 140
age: 15
speed: 30
Animal #0
Pfrrr
Horse will cover 1km in 0 hours
Animal #1
Pfrrr
Horse will cover 1km in 0.0333333 hours
</code></pre><p>Давай разберёмся почему так происходит.</p>
<p>В памяти каждый объект это просто набор байт. Например, объект типа <code>Cat</code> выглядит так:</p>
<p><img src="" alt=""></p>
<p>В массиве у нас лежат указатели на базовый класс <code>Animal*</code>, которые видят только эту часть объекта <code>Cat</code>:</p>
<p><img src="" alt=""></p>
<p>Если мы берём указатель <code>Horse*</code>, и пытаемся указать им на объект класса <code>Cat</code>, то ничего не сломается, так как в памяти оба этих объекта не отличимы друг от друга:</p>
<p><img src="" alt=""></p>
<p>То есть, <strong>тип указателя определяет какие методы мы можем вызывать у объекта</strong>.</p>
<p>Окей, а есть какая-то возможность автоматически определять тип объекта (<code>Cat*</code> или <code>Horse*</code>), и вызывать нужный метод, даже если у нас есть только указатель на базовый класс (<code>Animal*</code>)?</p>
<p>Да, есть!</p>
<h1 id="виртуальные-методы">Виртуальные методы</h1>
<p>Ситуация, описанная выше, решается за счёт <strong>полиморфизма</strong>.</p>
<p><strong>Полиморфизм</strong> &ndash; это инструмент языка программирования, который позволяет единообразно работать со множеством иерархически связанных классов.</p>
<p>С его помощью, мы сможем вызывать метод <code>talk()</code> у указателя <code>Animal*</code>, а при этом вызовется соответствующий метод, определённый в <code>Cat</code> или <code>Horse</code>.</p>
<p>В языке C++ полиморфизм реализован с помощью <strong>таблиц виртуальных функций</strong>. Про них я расскажу попозже, а пока давай ими воспользуемся.</p>
<p>Чтобы применить полиморфизм к методу, надо чтобы он был занесён в таблицу виртуальных функций. Для этого нужно написать <code>virtual</code> перед объявлением метода:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Animal</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> talk()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Abstract animal&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>В классах <code>Cat</code> и <code>Horse</code> также надо пометить методы <code>talk()</code> как <code>virtual</code> и указать, что они переопределяют виртуальный метод своего родителя:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Cat</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> talk() <span style="color:#66d9ef">override</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Mew mew&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Horse</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> talk() <span style="color:#66d9ef">override</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Pfrrr&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p><code>override</code> указывает, что эти методы переопределяют метод своего родителя в таблице виртуальных функций.</p>
<p>Давай попробуем теперь запустить программу в изначальном виде, только с вызовом <code>talk()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        animals[i]<span style="color:#f92672">-&gt;</span>talk();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Еееееее, всё работает!</p>
<pre tabindex="0"><code>count: 2
animal type (0 - cat, 1 - horse): 1
weight: 140
age: 15
speed: 30
animal type (0 - cat, 1 - horse): 0
weight: 0
age: 0
fluffiness: 0
Pfrrr
Mew mew
</code></pre><h1 id="таблицы-виртуальных-функций">Таблицы виртуальных функций</h1>
<h1 id="абстрактные-классы">Абстрактные классы</h1>


			</section>
		</div>
	</div>

    <footer>
    <a href="http://kee-reel.com/cpp/classes-polymorhism-ru/#top">
        <span>
            <b>🡅 В начало 🡅</b>
        </span>
    </a>
    <hr>
    <pre>
Home server: Raspberry Pi 4
Temperature: 27
Uptime: 5 hours, 35 minutes
    </pre>
</footer>

</body>
</html>
