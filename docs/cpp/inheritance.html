<!DOCTYPE html>
<html lang="ru">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
	<meta name="description" content="IT простым языком">
	<meta name="generator" content="HUGO">

	<meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="/sass/main.min.css">
    <title> IT простым языком </title>
</head>

<body>
	<div id="top"/>
<header>
    <div align="center">
        +---------------------------+<br>
        |.-------------------------.|<br>
        ||&nbsp;<a href="/">kee_reel@blog</a>:~$ cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/c">c</a>&nbsp;&nbsp;<a href="/cpp">c++</a>&nbsp;&nbsp;<a href="/python">python</a>&nbsp;&nbsp;<a href="/linux">linux</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/opengl">opengl</a>&nbsp;&nbsp;<a href="/sql">sql</a>&nbsp;&nbsp;<a href="/network">networks</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about">обо_мне</a>&nbsp;||<br>
        |.-------------------------.|<br>
        +-::---------------------::-+<br>
        .---------------------------.<br>
        &nbsp;//&nbsp;/o<a href="/links">o</a>oooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        &nbsp;//&nbsp;/oooooooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        //-------------------------------\\<br>
        \\-------------------------------//<br>
    </div>
    <hr>
</header>

		
	<div id="wrapper">
		<div class="container">
			<section id="main_content">
    
    
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/cpp/incapsulation.html">◀ Инкапсуляция</a>
            
            
                <div></div>
            
        </div>
        <hr>
    
    <h1>C&#43;&#43;. Наследование классов</h1>
    
    
        <h3>Время чтения: 12 мин</h3>
    
    <p><strong>Наследование</strong> &ndash; позволяет связать разные классы в иерархию таким образом, что мы можем в классе наследнике переиспользовать поля и методы, объявленные в родительском классе.</p>
<p>Давай сначала посмотрим на примере &ndash; допустим, у меня есть класс <code>Animal</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Конструктор с параметрами
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Animal</span><span class="p">(</span><span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_weight</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_max_age</span><span class="p">(</span><span class="n">max_age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Можем узнать старое ли это животное
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">is_old</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_age</span> <span class="o">&gt;</span> <span class="n">m_max_age</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Можем сравнить по весу с другим животным
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">is_bigger_than</span><span class="p">(</span><span class="n">Animal</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_weight</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">m_weight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_weight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_max_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Мы можем создать пару таких животных:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Animal</span> <span class="n">a1</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">a2</span><span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;First is old: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span><span class="p">.</span><span class="n">is_old</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// First is old: 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Second is old: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a2</span><span class="p">.</span><span class="n">is_old</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Second is old: 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;First is bigger than second: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span><span class="p">.</span><span class="n">is_bigger_than</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// First is bigger than second: 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>Всё работает, но жизни как-то не хватает &ndash; что это за животные такие абстрактные?</p>
<p><img src="/assets/images/cpp-inheritance-base.png" alt="Base class instances"></p>
<p>Давай хотя бы добавим кошку и лошадь! Кошка и лошадь являются животными, и оба могут иметь возраст и вес &ndash; то есть мы можем для них обоих использовать базовый класс Animal.</p>
<p>Класс, от которого мы хотим унаследоваться, указывавается через двоеточие после названия нашего класса:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><blockquote>
<p><code>public</code> наследовании пока прими как есть - про него я расскажу дальше</p>
</blockquote>
<p>Вот полный код новых классов <code>Cat</code> и <code>Horse</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Animal</span> <span class="p">{...};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cat</span><span class="p">(</span><span class="kt">float</span> <span class="n">fluffiness</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Animal</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_fluffiness</span><span class="p">(</span><span class="n">fluffiness</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">talk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Mew mew&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Сколько килограмм волос выпадет из кошки за день?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="nf">shed_weight</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_fluffiness</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Пушистость кошки (от 0.0 до 1.0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">m_fluffiness</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Horse</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Horse</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Animal</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_speed</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">talk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Pfrrr&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// За сколько часов на этой лошади можно преодолеть distance километров?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="nf">travel</span><span class="p">(</span><span class="kt">float</span> <span class="n">distance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">m_speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Скорость лошади в километрах в час
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">m_speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Особенности обращения с конструкторами и деструкторами при наследовании:</p>
<ul>
<li>Конструкторы и деструкторы не наследуются</li>
<li>Параметры конструкторов могут различаться &ndash; например, у меня в констукторах <code>Cat</code> и <code>Horse</code> нет параметра <code>max_age</code>, и я передаю в конструктор <code>Animal</code> фиксированное значение, в зависимости от типа животного</li>
<li>Если явно не вызывать конструктор базового класса из конструктора наследника, то будет вызван конструктор базового класса без параметров. Если у базового класса нет конструктора без параметров, то будет ошибка компиляции</li>
<li>При создании объекта сначала вызывается конструктор родителя, то есть порядок такой: <code>родитель-&gt;наследник-&gt;наследник_наследника-&gt;...</code></li>
<li>При удалении объекта сначала вызывается деструктор самого младшего наследника, то есть порядок такой:  <code>...-&gt;наследник_наследника-&gt;наследник-&gt;родитель</code></li>
</ul>
<p>Осталось только изменить код в <code>main()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cat</span> <span class="n">a1</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">a1</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Mew mew
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Horse</span> <span class="n">a2</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">268</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">a2</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Pfrrr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Cat is old: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span><span class="p">.</span><span class="n">is_old</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Cat is old: 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Horse is old: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a2</span><span class="p">.</span><span class="n">is_old</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Horse is old: 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Cat is bigger than horse: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span><span class="p">.</span><span class="n">is_bigger_than</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Cat is bigger than horse: 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Cat will shed about &#34;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">a1</span><span class="p">.</span><span class="n">shed_weight</span><span class="p">()</span> <span class="o">*</span> <span class="mi">365</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; kg of hair in a year&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Cat will shed about 29.2 kg of hair in a year
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Horse will travel 100km in about &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a2</span><span class="p">.</span><span class="n">travel_time</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; hours&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Horse will travel 100km in about 20.8333 hours
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><img src="/assets/images/cpp-inheritance-cat-horse.png" alt="Наследники"></p>
<p>То есть у наших кошки и лошади всё так же можно вызвать методы <code>is_old()</code> и <code>is_bigger_than()</code>, но при этом, у каждого из них есть свои уникальные методы <code>shed_weight()</code> и <code>travel_time()</code>.</p>
<h1 id="спецификатор-доступа-protected">Спецификатор доступа protected</h1>
<p>И это касается не только методов &ndash; поля <code>m_weight</code>, <code>m_age</code> и <code>m_max_age</code> тоже могут быть унаследованы &ndash; то есть мы сможем их использовать в <code>Cat</code> и <code>Horse</code>.</p>
<p>Например, давай сделаем так, что кошка будет меньше линять к старости:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">    <span class="kt">float</span> <span class="nf">shed_weight</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Приводим к float чтобы получить вещественное деление
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">float</span> <span class="n">age_multiplier</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">m_max_age</span> <span class="o">-</span> <span class="n">m_age</span><span class="p">)</span> <span class="o">/</span> <span class="n">m_max_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_fluffiness</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">age_multiplier</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>А для лошади сделаем так, что она будет бегать быстрее всего в молодости:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">    <span class="kt">float</span> <span class="nf">travel_time</span><span class="p">(</span><span class="kt">float</span> <span class="n">distance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">peak_age</span> <span class="o">=</span> <span class="n">m_max_age</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">age_multiplier</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">fabs</span><span class="p">(</span><span class="n">peak_age</span> <span class="o">-</span> <span class="n">m_age</span><span class="p">)</span> <span class="o">/</span> <span class="n">peak_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">distance</span> <span class="o">/</span> <span class="p">(</span><span class="n">m_speed</span> <span class="o">*</span> <span class="n">age_multiplier</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>При компиляции мы получим кучу ошибок такого вида:</p>
<pre tabindex="0"><code>main.cpp: In member function ‘float Cat::shed_weight()’:
main.cpp:39:33: error: ‘int Animal::m_max_age’ is private within this context
   39 |         float age_multiplier = (m_max_age - m_age) / m_max_age;
      |                                 ^~~~~~~~~
</code></pre><p>Я ожидал этого &ndash; сейчас поля <code>m_weight</code>, <code>m_age</code> и <code>m_max_age</code> объявлены как <code>private</code> &ndash; это значит, что к ним можно обращаться только из методов класса, в котором они объявлены.</p>
<p><img src="/assets/images/c-protected-fields.png" alt="protected"></p>
<p>Но я же говорил, что в наследниках можно будет использовать поля родительского класса, разве нет? Да, но для этого нам придётся изменить спецификатор доступа с <code>private</code> на <code>protected</code>.</p>
<p><code>protected</code> &ndash; это спецификатор доступа, который позволяет обращаться к методу/полю только из методов самого класса или методов его наследников.</p>
<p>Давай заменим <code>private</code> на <code>protected</code> в классе <code>Animal</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_weight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_max_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Теперь всё должно собраться без ошибок. Вот вывод программы, видно что значения выпадения волос и расстояния изменились:</p>
<pre tabindex="0"><code>Mew mew
Pfrrr
First is old: 1
Second is old: 0
First is bigger than second: 0
Cat will shed about 3.89333 kg of hair in a year
Horse will travel 100km in about 1.85185 hours
</code></pre><p>Используй <code>protected</code> для полей или методов если хочешь, чтобы классы наследники смогли их использовать. Если ты не планируешь этого, то лучше используй <code>private</code> &ndash; таким образом ты упростишь задачу тому, кто будет разбираться в твоём коде.</p>
<h1 id="спецификатор-доступа-в-наследовании">Спецификатор доступа в наследовании</h1>
<p>Как ты видел, при наследовании мы указали спецификатор <code>public</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>А можно ещё что-то указать? Да, можно:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// protected наследование
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="k">protected</span> <span class="n">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// private наследование
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="k">private</span> <span class="n">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>В зависимости от указанного типа наследования, спецификаторы доступа полей родительского класса изменятся в наследнике:</p>
<ul>
<li>При <code>public</code> наследовании
<ul>
<li><code>public</code> в родительском классе останется <code>public</code> в наследнике</li>
<li><code>protected</code> в родительском классе останется <code>protected</code> в наследнике</li>
<li><code>private</code> в родительском классе не унаследуется в наследнике</li>
</ul>
</li>
<li>При <code>protected</code> наследовании
<ul>
<li><code>public</code> в родительском классе превратится в <code>protected</code> в наследнике</li>
<li><code>protected</code> в родительском классе превратится в <code>protected</code> в наследнике</li>
<li><code>private</code> в родительском классе не унаследуется в наследнике</li>
</ul>
</li>
<li>При <code>private</code> наследовании
<ul>
<li><code>public</code> в родительском классе превратится в <code>private</code> в наследнике</li>
<li><code>protected</code> в родительском классе превратится в <code>private</code> в наследнике</li>
<li><code>private</code> в родительском классе не унаследуется в наследнике</li>
</ul>
</li>
</ul>
<p><code>protected</code> и <code>private</code> наследование используется в экзотических случаях, и я не буду их рассматривать в рамках этой статьи. Просто используй <code>public</code>, пока не захочешь погрузиться глубже в C++.</p>
<blockquote>
<p>Если не указывать тип наследования, то по умолчанию он будет <code>private</code>, поэтому не забывай всегда писать <code>public</code>.</p>
</blockquote>
<h1 id="наследник-наследника-и-переопределение-методов">Наследник наследника и переопределение методов</h1>
<p>Если программа очень сложная, то иерархия наследования может сильно разрастаться.</p>
<p><img src="/assets/images/cpp-multiple-inheritance.png" alt="Multiple inheritance"></p>
<p>Например, мы пишем программу, которая будет производить сложную симуляцию поведения животных, и нам обязательно надо разделить поведение домашних и уличных кошек:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// Домашняя кошка
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">DomesticCat</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cat</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">DomesticCat</span><span class="p">(</span><span class="kt">float</span> <span class="n">fluffiness</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Cat</span><span class="p">(</span><span class="n">fluffines</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">talk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Prrr prrrr&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Уличная кошка
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">StrayCat</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cat</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">StrayCat</span><span class="p">(</span><span class="kt">float</span> <span class="n">fluffiness</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Cat</span><span class="p">(</span><span class="n">fluffines</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">talk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Shchhhhhhhhh&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Теперь эти классы будут отличаться от поведения родительского класса <code>Cat</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cat</span> <span class="n">c</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Mew mew
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">DomesticCat</span> <span class="n">d</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Prrr prrrr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">StrayCat</span> <span class="n">s</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Shchhhhhhhhh
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>Таким образом, мы унаследовались от класса <code>Cat</code>, который, в свою очередь, наследуется от <code>Animal</code>.</p>
<p>Также, в классах <code>DomesticCat</code> и <code>StrayCat</code> мы переопределили метод <code>talk()</code> родительского класса <code>Cat</code>.</p>
<p>Однако, у нас есть проблема &ndash; из-за того, что максимальный возраст кошки определён в <code>Cat</code>, мы не можем его указать в <code>DomesticCat</code> и <code>StrayCat</code>. В следующем разделе я покажу как можно выйти из этого положения (компоненты).</p>
<h1 id="diamond-problem-проблема-ромбовидного-наследования">Diamond problem, проблема ромбовидного наследования</h1>
<p>Ситуация &ndash; генетики скрестили между собой птицу и лошадь, и получили пегаса:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bird</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bird</span><span class="p">(</span><span class="kt">float</span> <span class="n">max_height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Animal</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_max_height</span><span class="p">(</span><span class="n">max_height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">talk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Tweet tweet&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Может ли летать на такой высоте
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">can_fly</span><span class="p">(</span><span class="kt">float</span> <span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_max_height</span> <span class="o">&gt;=</span> <span class="n">height</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Максимальная высота полёта
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">m_max_height</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pegasus</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Horse</span><span class="p">,</span> <span class="k">public</span> <span class="n">Bird</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pegasus</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flight_height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Horse</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Bird</span><span class="p">(</span><span class="n">flight_height</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Я не хочу переопределять метод talk(), потому что пегас 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// должен &#34;говорить&#34; как так же, как класс Horse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></div><p>Давай создадим объект класса <code>Pegasus</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pegasus</span> <span class="n">p</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>При компиляции вылезет ошибка:</p>
<pre tabindex="0"><code>animal.cpp: In function ‘int main()’:
animal.cpp:120:7: error: request for member ‘talk’ is ambiguous
120 |     p.talk();
    |       ^~~~
animal.cpp:12:10: note: candidates are: ‘void Animal::talk()’
 12 |     void talk()
    |          ^~~~
animal.cpp:83:10: note:                 ‘void Bird::talk()’
 83 |     void talk()
    |          ^~~~
animal.cpp:60:10: note:                 ‘void Horse::talk()’
 60 |     void talk()
    |          ^~~~
</code></pre><p>Компилятор говорит, что он не может разобраться чей же метод <code>talk()</code> мы хотим вызывать &ndash; <code>Animal::talk()</code>, <code>Bird::talk()</code> или <code>Horse::talk()</code>?</p>
<p>Эта проблема называется <strong>&ldquo;Diamond inheritance problem&rdquo;</strong> &ndash; на наш можно перевести как <strong>&ldquo;Проблема ромбовидного наследования&rdquo;</strong>.</p>
<p>Ромб тут описывает форму иерархии наследования, когда класс <code>Pegasus</code>, наследуется от <code>Horse</code> и <code>Bird</code>, которые, в свою очередь наследуются от <code>Animal</code>:</p>
<p><img src="/assets/images/cpp-diamond-inheritance.png" alt="Multiple inheritance"></p>
<p>Класс <code>Pegasus</code> будет содержать в себе две копии базового класса <code>Animal</code> &ndash; одну от <code>Horse</code>, одну от <code>Bird</code>.</p>
<p>Если такая ситуация возникает, то, скорее всего, мы неправильно организовали саму иерархию наследования.</p>
<p>Как же нам поступить? Можно выделить 3 способа:</p>
<h3 id="явное-указание-родительского-класса">Явное указание родительского класса</h3>
<p>При вызове метода или обращении к полю в таком случае можно использовать явное указание родительского класса:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pegasus</span> <span class="n">p</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">::</span><span class="n">Horse</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span> <span class="c1">// Pfrrr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">p</span><span class="o">::</span><span class="n">Horse</span><span class="p">.</span><span class="n">is_old</span><span class="p">();</span> <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">p</span><span class="o">::</span><span class="n">Bird</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span> <span class="c1">// Tweet tweet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">p</span><span class="o">::</span><span class="n">Horse</span><span class="p">.</span><span class="n">is_old</span><span class="p">();</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>Можно выделить 2 существенных недостатка:</p>
<ul>
<li>В нашем объекте существует две копии базового класса &ndash; значит поля <code>m_age</code>, <code>m_max_age</code>, <code>m_weight</code> дублируются</li>
<li>Наш класс содержит методы, которые не должны в нём быть (пегас чирикает как птичка)</li>
</ul>
<h3 id="виртуальное-наследование">Виртуальное наследование</h3>
<p>В языке С++ есть способ сообщить компилятору, что мы хотим иметь базовый класс только в одном экземпляре:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Horse</span> <span class="o">:</span> <span class="k">public</span> <span class="k">virtual</span> <span class="n">Animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bird</span> <span class="o">:</span> <span class="k">public</span> <span class="k">virtual</span> <span class="n">Animal</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pegasus</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Horse</span><span class="p">,</span> <span class="k">public</span> <span class="n">Bird</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>В таком случае создастся только один экземпляр базового класса, который будет поделён между <code>Horse</code> и <code>Bird</code>. Однако, у нас всё ещё остаётся проблема с тем, что метод <code>talk()</code> переопределён в обоих классах.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pegasus</span> <span class="n">p</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="p">.</span><span class="n">is_old</span><span class="p">();</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">p</span><span class="o">::</span><span class="n">Horse</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span> <span class="c1">// Pfrrr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">p</span><span class="o">::</span><span class="n">Bird</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span> <span class="c1">// Tweet tweet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>Недостатки:</p>
<ul>
<li>Нужно следить, чтобы все родительские классы наслежовались с <code>virtual</code></li>
<li>Если конструкторы классов родителей записывают в поля базового класса разные значения, то получается очень запутанное поведение. В нашем случае родительские классы передают в базовый класс различные значения поля <code>m_max_age</code> &ndash; в итоге там остаётся значение, которое было записано одним из конструкторов <code>Horse</code> или <code>Animal</code>, который вызвался последним</li>
<li>Не решает проблему, если оба класса родителя переопределили какой-то метод. В нашем случае они переопределили <code>talk()</code></li>
</ul>
<h3 id="компоненты">Компоненты</h3>
<p>Одним из выходов, является выделение общих признаков для классов <code>Animal</code>, <code>Horse</code> и <code>Bird</code> в отдельные классы: <code>Aging</code> (стареющее), <code>Weight</code> (вес), <code>Walking</code> (ходячее), <code>Flying</code> (летающее), <code>Talking</code> (разговаривающее).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Aging</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Aging</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_max_age</span><span class="p">(</span><span class="n">max_age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">is_old</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_age</span> <span class="o">&gt;</span> <span class="n">m_max_age</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_max_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Weight</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Weight</span><span class="p">(</span><span class="kt">int</span> <span class="n">weight</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_weight</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">is_bigger_than</span><span class="p">(</span><span class="n">Weight</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_weight</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">m_weight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">m_weight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Walking</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Walking</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_speed</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="nf">travel_time</span><span class="p">(</span><span class="kt">float</span> <span class="n">distance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">m_speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">m_speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Flying</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Flying</span><span class="p">(</span><span class="kt">float</span> <span class="n">max_height</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_max_height</span><span class="p">(</span><span class="n">max_height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">can_fly</span><span class="p">(</span><span class="kt">float</span> <span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m_max_height</span> <span class="o">&gt;=</span> <span class="n">height</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Максимальная высота полёта
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">m_max_height</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Talking</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Talking</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">phrase</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">m_phrase</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">phrase</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">strcpy</span><span class="p">(</span><span class="n">m_phrase</span><span class="p">,</span> <span class="n">phrase</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Talking</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">delete</span><span class="p">[]</span> <span class="n">m_phrase</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">talk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">m_phrase</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span><span class="o">*</span> <span class="n">m_phrase</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pegasus</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Aging</span><span class="p">,</span> <span class="k">public</span> <span class="n">Weight</span><span class="p">,</span> <span class="k">public</span> <span class="n">Walking</span><span class="p">,</span> <span class="k">public</span> <span class="n">Flying</span><span class="p">,</span> <span class="k">public</span> <span class="n">Talking</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pegasus</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Aging</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Weight</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Walking</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Flying</span><span class="p">(</span><span class="n">height</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Talking</span><span class="p">(</span><span class="s">&#34;Pfrrrr&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pegasus</span> <span class="n">p</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="p">.</span><span class="n">talk</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Таким образом, мы разбили классы родителей на независимые компоненты, из которых можно собирать различные комбинации:</p>
<ul>
<li>Камень: Weight</li>
<li>Снежинка: Flying</li>
<li>Метеорит: Weight, Flying</li>
<li>Громкоговоритель: Talking</li>
<li>Кусок льда на жарком солнце: Weight, Aging</li>
</ul>
<p>И так далее, всё что фантазия насобирает&hellip; А если будет не хватать компонентов, то всегда можно добавить ещё.</p>
<blockquote>
<p>Можешь почитать в интернете про ECS (Entity Component System) &ndash; подход к организации всех данных в программе в виде компонентов.</p>
</blockquote>
<p><img src="/assets/images/cpp-diamond-inheritance-components.png" alt="Components"></p>
<p>В программировании, как и в жизни, не бывает идеальных решений &ndash; здесь, мы решили одну проблему, но создали другую &ndash; наследование сильно усложнилось. Если твоя задача позволяет обойтись обычным наследованием, без выделения компонентов, то лучше постарасться обойтись малой кровью.</p>
<blockquote>
<p>Проблема ромбовидного наследования характерна для всех языков программирования, которые поддерживают парадигму ООП &ndash; это проблема самого ООП</p>
</blockquote>
<h1 id="заключение">Заключение</h1>
<p>Итого, мы изучили:</p>
<ul>
<li>Наследование</li>
<li><strong>Родительский класс</strong> aka. <strong>Базовый класс</strong> aka. <strong>Родитель</strong></li>
<li><strong>Дочерний класс</strong> aka. <strong>Наследник</strong> aka. <strong>Ребёнок</strong></li>
<li>Конструкторы и деструкторы в наследовании:
<ul>
<li>Конструкторы и деструкторы не наследуются</li>
<li>Параметры конструкторов могут различаться</li>
<li>Если не вызовем вручную, то вызовется конструктор базового класса без параметров</li>
<li>Порядок вызова конструкторов: <code>родитель-&gt;наследник-&gt;наследник_наследника-&gt;...</code></li>
<li>Порядок вызова деструкторов: <code>...-&gt;наследник_наследника-&gt;наследник-&gt;родитель</code></li>
</ul>
</li>
<li><code>protected</code> &ndash; доступ только из самого класса или его наследников</li>
<li><code>public</code> наследование берёт всё как есть, <code>protected</code> и <code>private</code> наследование &ndash; изменяют модификаторы доступа</li>
</ul>
<p>И, ещё раз, смысл наследования:</p>
<h3 id="тебе-не-надо-дублировать-одинаковую-логику-в-разных-классах----логика-пишется-один-раз-в-родительском-классе-и-переиспользуется-во-всех-дочерних-классах">Тебе не надо дублировать одинаковую логику в разных классах &ndash; логика пишется один раз в родительском классе, и переиспользуется во всех дочерних классах.</h3>
<p>Если что &ndash; пиши, я помогу и постараюсь объяснить лучше.</p>

    <hr>
    <div align="center">
        <a href="https://kee-reel.com/cpp/inheritance.html#top">▲ В начало ▲</a>
    </div>
    
        <hr>
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/cpp/incapsulation.html">◀ Инкапсуляция</a>
            
            
                <div></div>
            
        </div>
    

			</section>
		</div>
	</div>

    <footer>
    <hr>
    <div align="center">
        Home server: Raspberry Pi 4<br>
        Temperature: 41<br>
Uptime: 1 hour, 43 minutes
    </div>
</footer>

</body>
</html>
